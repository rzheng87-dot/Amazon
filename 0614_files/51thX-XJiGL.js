'use strict';(function(m){var f=window.AmazonUIPageJS||window.P,t=f._namespace||f.attributeErrors,d=t?t("REXMapTrackingAssets@maptracking","REXMapTrackingAssets"):f;d.guardFatal?d.guardFatal(m)(d,window):d.execute(function(){m(d,window)})})(function(m,f,t){m.declare("rex-maptracker-constants",{classPrefix:"rex-maptracking",maxZoom:17,minZoom:3,styles:{deliveryAgentBubble:{style:{body:{backgroundColor:"#fff",color:"#000",fontSize:".8em",padding:".3em .1em",right:"-3.75em",bottom:"4em",borderRadius:"1em",
textAlign:"center"},content:{minWidth:"8em"}},tail:{path:{fill:"#FFF"},viewBox:"0 0 20 20",shape:"M0 0 L6 8 L12 0 Z",style:{bottom:"2em"}}},destinationBubble:{style:{body:{backgroundColor:"#fff",color:"#000",fontSize:".8em",padding:".3em .1em",right:"-3.75em",bottom:"2.5em",borderRadius:"1em",textAlign:"center"},content:{minWidth:"8em"}}}},REAL_TIME_MAP_TYPE:{DEFAULT:"Default",DRONE:"Drone"},metrics:{PIN_SMOOTHING_MAP_UPDATE_ERROR:"od-pin-smoothing-map-update-error",PIN_SMOOTHING_MAP_UPDATE_ERROR_LOG:"od-pin-smoothing-map-update-error-log",
PIN_SMOOTHING_AJAX_ERROR:"od-pin-smoothing-ajax-error",PIN_SMOOTHING_AJAX_ERROR_LOG:"od-pin-smoothing-ajax-error-log",PIN_SMOOTHING_AJAX_DRONE_ERROR_LOG:"od-pin-smoothing-ajax-drone-error-log",PIN_SMOOTHING_AJAX_IMMEDIATE_ERROR_RETRY_ATTEMPT:"od-pin-smoothing-ajax-immediate-error-retry-attempt-",PIN_SMOOTHING_AJAX_POLLING_ERROR_RETRY_ATTEMPT:"od-pin-smoothing-ajax-polling-error-retry-attempt-",PIN_SMOOTHING_KALMAN_FILTER_UPDATE:"od-pin-smoothing-kalman-filter-update",PIN_SMOOTHING_KALMAN_FILTER_UPDATE_ERROR:"od-pin-smoothing-kalman-filter-update-error",
PIN_SMOOTHING_KALMAN_FILTER_UPDATE_ERROR_LOG:"od-pin-smoothing-kalman-filter-update-error-log",PIN_SMOOTHING_ROUTE_FILTER_HIT:"od-pin-smoothing-route-filter-hit",PIN_SMOOTHING_ROUTE_FILTER_SUCCESS:"od-pin-smoothing-route-filter-success",PIN_SMOOTHING_ROUTE_FILTER_EMPTY_RESPONSE:"od-pin-smoothing-route-filter-empty-response",PIN_SMOOTHING_ROUTE_FILTER_EMPTY_ROUTE:"od-pin-smoothing-route-filter-empty-route",PIN_SMOOTHING_ROUTE_FILTER_ERROR:"od-pin-smoothing-route-filter-error",PIN_SMOOTHING_ROUTE_FILTER_ERROR_LOG:"od-pin-smoothing-route-filter-error-log",
HERE_MAPS_API_KEY_FROM_CONFIG:"od-here-maps-api-key-from-config",HERE_MAPS_API_KEY_FROM_PAGE_STATE:"od-here-maps-api-key-from-page-state",HERE_ROUTE_MATCHING_API_KEY_FROM_CONFIG:"od-here-route-matching-api-key-from-config",HERE_ROUTE_MATCHING_API_KEY_FROM_PAGE_STATE:"od-here-route-matching-api-key-from-page-state",HERE_ROUTE_MATCHING_LATENCY:"od-here-route-matching-latency",MAP_TRACKING_AJAX_ERROR_RETRY:"od-map-tracking-ajax-error-retry"}});m.declare("pin-smoothing-config",{delay:{defaultInMilliseconds:15E4,
maxInMilliseconds:21E4,initialMaxInMilliseconds:24E4,successfullAddLocationsCountToUseDefaultMax:4},mapUpdate:{defaultIntervalInMilliseconds:1E3,fastIntervalInMilliseconds:800},polling:{defaultIntervalInMilliseconds:3E4,defaultMaxDelayInMilliseconds:5E3,errorIntervalInMilliseconds:3E4,errorMaxDelayInMilliseconds:5E3,immediateIntervalInMilliseconds:50,immediateMaxDelayInMilliseconds:30,getDefaultIntervalInMilliseconds:function(d,c){return this.defaultIntervalInMilliseconds+this.calculateJitterWithExponentialBackoff(d,
c,this.defaultMaxDelayInMilliseconds)},getErrorIntervalInMilliseconds:function(d,c){return this.errorIntervalInMilliseconds+this.calculateJitterWithExponentialBackoff(d,c,this.errorMaxDelayInMilliseconds)},getImmediateIntervalInMilliseconds:function(d,c){return this.immediateIntervalInMilliseconds+this.calculateJitterWithExponentialBackoff(d,c,this.immediateMaxDelayInMilliseconds)},calculateJitterWithExponentialBackoff:function(d,c,q){return 0===d?0:Math.floor(Math.random()*Math.min(q*Math.pow(2,
d-c),q))}},outlier:{velocityThresholdInMetersPerSecond:200,accuracyThreshold:30},jitter:{rules:[{subsequentPoints:4,maxDisplacementInMeters:50},{subsequentPoints:1,maxDisplacementInMeters:15}]},interpolation:{maxDistanceToProcessInMeters:500,intervalTargetInMilliseconds:1E3},smoothing:{measurementCovariance:2,processCovariance:1,smoothingType:"KALMAN_FILTER"},transition:{maxDisplacementInMeters:Infinity,intervalInMilliseconds:800},lostSignal:{callThreshold:5,initialPageLoadCallThreshold:3,pollingCallThreshold:5}});
m.register("rex-maptracker-environments",function(){function d(){var a=f.location.hostname,c="";null!=a&&""!=a&&(c=a.split(".").pop());return c}function c(){var a=!1,c=f.location.hostname;q.forEach(function(g){c.includes(g)&&(a=!0)});return a}var q=["development","pre-prod"],e={com:{region:"na",domain:"com",imperial:!0},uk:{region:"eu",domain:"co.uk",imperial:!1},de:{region:"eu",domain:"de",imperial:!1},fr:{region:"eu",domain:"fr",imperial:!1},es:{region:"eu",domain:"es",imperial:!1},it:{region:"eu",
domain:"it",imperial:!1},"":{region:"na",domain:"com",imperial:!0}};return{getTopLevelDomain:d,getEnvConfig:function(){var a=c();if(a){var g=f.location.hostname.split(".")[0];g=g.substring(0,g.indexOf("pre-prod")-1)}else g=d();e[g]||(g="com");g=e[g]||{};g.isPreProd=a;return g}}});m.when("holiday-cheer").register("rex-maptracker-icons",function(d){return{agent:"https://do6e2c3moa96p.cloudfront.net/StaticContent/pm_driver_pin.png",drone:"https://m.media-amazon.com/images/G/01/primeair/drone-icon_v2_52.png",
destination:d.isEnabled?"https://m.media-amazon.com/images/G/01/x-locale/cs/ship-track/pt2/holiday/2025/Holiday25/Holiday_Cheer_Pin_2x._CB775957449_.png":"https://do6e2c3moa96p.cloudfront.net/StaticContent/pm_destination_pin.png",default:"https://do6e2c3moa96p.cloudfront.net/StaticContent/pm_destination_pin.png"}});"use strict";m.when("A","ready").register("pt2-page-utils",function(d){return{modifyPageScrollStatus:function(c){var q=d.$("#a-page"),e=d.$("body");if(c){var a=e.scrollTop();d.requestAnimationFrame(function(){q.css({position:"fixed",
top:"-"+a+"px"})},q[0])}else d.requestAnimationFrame(function(){q.css({position:"",top:""});e.scrollTop(a)},q[0])},debounce:function(c,d,e){var a;return function(){var g=this,p=arguments,b=e&&!a;clearTimeout(a);a=setTimeout(function(){a=null;e||c.apply(g,p)},d);b&&c.apply(g,p)}}}});m.when("A","ready").register("preload-images",function(d){function c(d){c.list||(c.list=[]);for(var e=c.list,a=0;a<d.length;a++){var g=new Image;g.onload=function(){var a=e.indexOf(this);-1!==a&&e.splice(a,1)};e.push(g);
g.src=d[a]}}return{preloadImages:c}});m.when("A","ready").register("map-tracking-status",function(d){return{RENDERED:"RENDERED",OUT_FOR_DELIVERY:"OUT_FOR_DELIVERY",PICKED_UP:"PICKED_UP",YOU_ARE_NEXT:"YOU_ARE_NEXT",DELIVERED:"DELIVERED",DELIVERED_CONFIRMED:"DELIVERED_CONFIRMED",ERROR:"ERROR",FATAL:"FATAL",ADDRESS_NOT_FOUND:"ADDRESS_NOT_FOUND",SKIPPED_STOP:"SKIPPED_STOP",DELIVERY_FAILED:"DELIVERY_FAILED",PARTIALLY_DELIVERED:"PARTIALLY_DELIVERED",DELIVERY_ATTEMPTED:"DELIVERY_ATTEMPTED",NOT_DELIVERED:"NOT_DELIVERED",
REJECTED:"REJECTED",UNKNOWN:"UNKNOWN"}});m.when("A","ready").register("failsafe",function(d){function c(a){g=a;k=(new Date).getTime();l=setTimeout(function(){b=!0;p()},g)}function f(){l&&clearTimeout(l);l=null}var e,a,g,p,b=!1,l=null,k=null,h=null;return{init:function(b){b=b||{};e=b.initialDelay||3500;a=b.extension||500;p=b.onTimeout||function(){};h=(new Date).getTime();c(e)},reset:f,extend:function(){if(!b){var h=(new Date).getTime()-k;h=g-h+a;f();0<h&&c(h)}},hasFired:function(){return b},totalElapsedTime:function(){return(new Date).getTime()-
h}}});m.when("A","map-tracking-status","response-code","csm-metrics-utils","ready").register("map-tracking-confirmation",function(d,c,q,e){f.location.host.indexOf("hp-shoppingportal");return function(a,c,p){d.$('meta[name\x3d"pt-csrf-token"]').attr("content");e.incrementCount("map-tracking-delivered-primary-refresh-queued");setTimeout(function(){e.incrementCount("map-tracking-delivered-primary-refresh-invoked");var a=new URL(f.location.href);a.searchParams.set("deliveredRefresh","1");f.location.href=
a.toString()},1E4)}});m.when("A","ready").register("response-code",function(d){return{UNSTRUSTED_REQUEST:"UNSTRUSTED_REQUEST",INVALID_TOKEN:"INVALID_TOKEN",AUTHENTICATED:"AUTHENTICATED",NOT_AUTHENTICATED:"NOT_AUTHENTICATED",MISSING_INPUTS:"MISSING_INPUTS",SUCCESS:"SUCCESS",SERVICE_FAILED:"SERVICE_FAILED",UNKNOWN_ACTION:"UNKNOWN_ACTION"}});m.when("A","csm-metrics-utils","ready").execute("delivery-refresh-handler",function(d,c){"undefined"!==typeof URLSearchParams&&(new URLSearchParams(f.location.search)).has("deliveredRefresh")&&
(c.incrementCount("map-tracking-delivered-secondary-refresh-queued"),"undefined"!==typeof URL&&f.history&&f.history.replaceState&&(d=new URL(f.location.href),d.searchParams.delete("deliveredRefresh"),f.history.replaceState({},"",d.toString())),setTimeout(function(){c.incrementCount("map-tracking-delivered-secondary-refresh-invoked");f.location.reload()},3E5))});m.register("here-maps-loader",function(){var d=!1,c=[];return{load:function(f){if(d)f();else if(c.push(f),!(1<c.length)){var e="https://do6e2c3moa96p.cloudfront.net/3p_here/v3/3.1.38.0/mapsjs-core.js https://do6e2c3moa96p.cloudfront.net/3p_here/v3/3.1.38.0/mapsjs-core-legacy.js https://do6e2c3moa96p.cloudfront.net/3p_here/v3/3.1.38.0/mapsjs-service.js https://do6e2c3moa96p.cloudfront.net/3p_here/v3/3.1.38.0/mapsjs-service-legacy.js https://do6e2c3moa96p.cloudfront.net/3p_here/v3/3.1.38.0/mapsjs-mapevents.js https://do6e2c3moa96p.cloudfront.net/3p_here/v3/3.1.38.0/mapsjs-ui.js".split(" "),
a=function(g){if(g>=e.length)d=!0,c.forEach(function(a){a()}),c=[];else{var p=document.createElement("script");p.src=e[g];p.onload=function(){a(g+1)};document.head.appendChild(p)}};a(0)}}}});m.when("here-maps-loader").execute("init-maps",function(d){d.load(function(){m.declare("here-maps-ready")})});m.when("rex-maptracker-constants","csm-metrics-utils","ready").register("rex-kalman-filter",function(d,c){function f(c,a){this.reset(c,a)}f.prototype.reset=function(c,a){this.processedAtLeastOnce=!1;this.measurementNoiseCovariance=
this.initialMeasurementNoiseCovariance=c;this.processNoiseCovariance=a;this.errorCovarianceMatrix=this.measurementMatrix=this.stateTransitionMatrix=1;this.kalmanGain=this.stateEstimate=0};f.prototype.predict=function(c){c===t&&(c=1);this.measurementNoiseCovariance=this.initialMeasurementNoiseCovariance*c;this.stateEstimate*=this.stateTransitionMatrix;this.errorCovarianceMatrix=this.stateTransitionMatrix*this.stateTransitionMatrix*this.errorCovarianceMatrix+this.processNoiseCovariance};f.prototype.update=
function(e,a){c.incrementCount(d.metrics.PIN_SMOOTHING_KALMAN_FILTER_UPDATE);this.kalmanGain=this.errorCovarianceMatrix*this.measurementMatrix/(this.measurementMatrix*this.measurementMatrix*this.errorCovarianceMatrix+this.measurementNoiseCovariance);this.stateEstimate=!this.processedAtLeastOnce||a?e:this.stateEstimate+this.kalmanGain*(e-this.measurementMatrix*this.stateEstimate);this.errorCovarianceMatrix*=1-this.kalmanGain*this.measurementMatrix;this.processedAtLeastOnce=!0;isNaN(this.stateEstimate)&&
(this.stateEstimate=e,c.incrementCount(d.metrics.PIN_SMOOTHING_KALMAN_FILTER_UPDATE_ERROR))};return f});m.register("here-route-matching-request",function(){function d(c){return{type:"Feature",properties:{provider:"gps",timestamp_msec:c.timestamp,accuracy:c.accuracy},geometry:{type:"Point",coordinates:[c.longitude,c.latitude]}}}return function(c){return{type:"FeatureCollection",features:c.map(d)}}});m.when("A","rex-maptracker-constants","csm-metrics-utils").register("here-route-matching-proxy",function(d,
c,f){function e(a){this.apiKey=a.apiKey;this.baseUrl="https://routematching.hereapi.com/v8/match/routelinks";this.scopePrefix="mapTrackerHereRouteMatchingAjaxLatencyScope";this.scopeIdentifier=1}e.prototype.getMatchedRoute=function(a){var c=this._buildUrl(),e=this._buildCsmScope();this._incrementScopeIdentifier();f.setPreAjax(e);var b=performance.now();return new Promise(function(g,k){d.post(c,{params:JSON.stringify(a),contentType:"application/json; charset\x3dutf-8",paramsFormat:"json",success:this._handleResponse(g,
k,e,b).bind(this),error:function(a){this._handlePostAjax(e,b);k(a)}.bind(this)})}.bind(this))};e.prototype._buildUrl=function(){var a=new URL(this.baseUrl);a.searchParams.set("routeMatch","1");a.searchParams.set("mode","car");this.apiKey&&a.searchParams.set("apiKey",this.apiKey);return a.toString()};e.prototype._handleResponse=function(a,c,d,b){return function(g){this._handlePostAjax(d,b);g.error_id?c(g):a(g)}.bind(this)};e.prototype._buildCsmScope=function(){return f.setScope(this.scopePrefix+this.scopeIdentifier)};
e.prototype._incrementScopeIdentifier=function(){this.scopeIdentifier++};e.prototype._handlePostAjax=function(a,c){this._recordPostAjaxLatencyMetric(c);f.setPostAjax(a);f.sendAjaxMetrics(a)};e.prototype._recordPostAjaxLatencyMetric=function(a){var g=performance.now();f.recordInterval(c.metrics.HERE_ROUTE_MATCHING_LATENCY,g-a)};return e});m.when("rex-maptracker-constants","ready").register("rex-route-matching",function(d){return{isRouteMatchingEnabled:function(c){return c===d.REAL_TIME_MAP_TYPE.DRONE?
!1:!0}}});m.when("A","here-route-matching-proxy","here-route-matching-request","rex-maptracker-constants","csm-metrics-utils","ready").register("rex-route-filter",function(d,c,f,e,a){function g(a,c){return a.route&&a.route.length?a.route[0].waypoint.map(function(a){var b=c.find(function(b){return b.timestamp===a.timestamp});return p(a,b||{})}):b(k.EMPTY_ROUTE,c)}function p(a,b){return{latitude:a.mappedPosition.latitude,longitude:a.mappedPosition.longitude,accuracy:a.minError,timestamp:a.timestamp,
isReal:!1,isSmoothed:b.isSmoothed||!1,interpolatedTo:b.interpolatedTo||!1,isJitterFiltered:b.isJitterFiltered||!1,isRouteFiltered:!0}}function b(b,k){(b=l(b))&&a.incrementCount(b);return k}function l(a){switch(a){case k.SUCCESS:return e.metrics.PIN_SMOOTHING_ROUTE_FILTER_SUCCESS;case k.ERROR:return e.metrics.PIN_SMOOTHING_ROUTE_FILTER_ERROR;case k.EMPTY_RESPONSE:return e.metrics.PIN_SMOOTHING_ROUTE_FILTER_EMPTY_RESPONSE;case k.EMPTY_ROUTE:return e.metrics.PIN_SMOOTHING_ROUTE_FILTER_EMPTY_ROUTE;default:return""}}
d=d.state("map-tracking-card-page-state");var k={SUCCESS:"SUCCESS",ERROR:"ERROR",EMPTY_RESPONSE:"EMPTY_RESPONSE",EMPTY_ROUTE:"EMPTY_ROUTE"},h=new c({apiKey:d&&d.hereMapsAPIKey?d.hereMapsAPIKey:null});return{filterRoute:function(c){if(0===c.length)return Promise.resolve([]);a.incrementCount(e.metrics.PIN_SMOOTHING_ROUTE_FILTER_HIT);var d=f(c);return h.getMatchedRoute(d).then(function(h){if(!h.response)return b(k.EMPTY_RESPONSE,c);var d=l(k.SUCCESS);d&&a.incrementCount(d);return g(h.response,c)}).catch(function(h){a.logError({error:h,
feature:e.metrics.PIN_SMOOTHING_ROUTE_FILTER_ERROR_LOG,message:"Pin smoothing route filter error for "+c.length+" locations"});return b(k.ERROR,c)})}}});m.when("A","rex-maptracker-constants","rex-maptracker-icons","holiday-cheer","pin-smoothing-config").register("rex-maptracker-item",function(d,c,f,e,a){function g(a,b,c,k,h){this.type=a;this.latitude=b;this.longitude=c;this.bubbleContent=k||"";this.realTimeMapType=h;this.iconSrc=f[a]||f.default;this.initialized=!1;this.markerDomRef=null;this.resetTransitionEventListener=
this.resetTransition.bind(this)}g.itemType={DELIVERY_AGENT:"agent",DESTINATION:"destination"};g.prototype.init=function(a){this.initialized||(this.maptracker=a,a={},this.type===g.itemType.DELIVERY_AGENT&&(a.onAttach=this.onAttach.bind(this),a.onDetach=this.onDetach.bind(this)),this.icon=e.isEnabled&&this.type===g.itemType.DELIVERY_AGENT?e.instantiateAnimatedDeliveryAgentIcon(a)||this.instantiateIcon(a):this.instantiateIcon(a),this.marker=this.instantiateMarker(),this.bubble=Object.assign({},this.type===
g.itemType.DELIVERY_AGENT?c.styles.deliveryAgentBubble:c.styles.destinationBubble),this.updateBubble(this.bubbleContent),this.maptracker.map.addObject(this.marker),this.initialized=!0)};g.prototype.instantiateIcon=function(a){var b=document.createElement("img");b.crossOrigin="anonymous";b.src=this.iconSrc;b.classList.add("od-map-item-icon");b.classList.add("od-map-item-icon__"+this.type);var c=document.createElement("div");c.classList.add("od-map-item-icon-container");c.classList.add("od-map-item-icon-container__"+
this.type);c.appendChild(b);try{return new H.map.DomIcon(c,a)}catch(k){}};g.prototype.instantiateMarker=function(){try{return new H.map.DomMarker({lat:this.latitude,lng:this.longitude},{icon:this.icon})}catch(p){}};g.prototype.updateBubble=function(a){this.bubble.instant||(this.type===g.itemType.DELIVERY_AGENT?this.instantiateAgent():this.instantiateDestination());this.bubbleContent=a;this.bubble.instant&&(this.bubble.instant.setContent(this.bubbleContent),this.bubbleContent?this.bubble.instant.open():
this.bubble.instant.close(),this.marker&&this.bubble.instant.setPosition(this.marker.getGeometry()))};g.prototype.updateLocation=function(a,b,c){this.latitude=a;this.longitude=b;c||this.resetTransition();this.marker&&(this.marker.setGeometry({lat:a,lng:b}),this.bubble.instant.setPosition({lat:a,lng:b}))};g.prototype.remove=function(){this.maptracker.map.removeObject(this.marker);this.maptracker.ui.removeBubble(this.bubble)};g.prototype.instantiateAgent=function(){this.bubble.instant=new H.ui.InfoBubble(this.marker.getGeometry(),
{content:""});var a=this.maptracker.mapElement.id+"-da-bubble";this.bubble.instant.addClass(a);this.maptracker.ui.addBubble(this.bubble.instant);a=d.$("."+a);var b=a.children(".H_ib_body"),c=this.maptracker.mapElement.querySelector(".H_ib_body");c.classList.remove("H_ib_body");c.classList.add("agent");b.children(".H_ib_close").hide();b=this.maptracker.mapElement.querySelector(".H_ib_content");b.classList.remove("H_ib_content");b.classList.add("bubble-content");a=a.children(".H_ib_tail");b=d.$("\x3cg\x3e").append(d.$("\x3cpath\x3e").attr("d",
this.bubble.tail.shape).css(this.bubble.tail.path));b=d.$("\x3csvg\x3e").attr("viewBox",this.bubble.tail.viewBox).append(b);a.html(b);b=this.maptracker.mapElement.querySelector(".H_ib_tail");b.classList.add("agent-tail");b.classList.remove("H_ib_tail");a.html(a.html())};g.prototype.instantiateDestination=function(){this.bubble.instant=new H.ui.InfoBubble(this.marker.getGeometry(),{content:""});var a=this.maptracker.mapElement.id+"-de-bubble";this.bubble.instant.addClass(a);this.maptracker.ui.addBubble(this.bubble.instant);
a=d.$("."+a);a.css({height:"0"});var b=this.maptracker.mapElement.querySelector(".H_ib_body");b.classList.remove("H_ib_body");b.classList.add("destination");var c=this.maptracker.mapElement.querySelector(".H_ib_content");c.classList.remove("H_ib_content");c.classList.add("bubble-content");a.children(".destination").children(".H_ib_close").hide();c=this.maptracker.mapElement.querySelector(".H_ib_tail");c.classList.remove("H_ib_tail");c.classList.add("destination-tail");a.children(".destination-tail").hide();
b.classList.add("show-destination")};g.prototype.onAttach=function(a){this.markerDomRef=a;this.resetTransition();this.maptracker&&this.maptracker.map&&this.maptracker.map.addEventListener("mapviewchange",this.resetTransitionEventListener)};g.prototype.onDetach=function(){this.maptracker&&this.maptracker.map&&this.maptracker.map.removeEventListener("mapviewchange",this.resetTransitionEventListener)};g.prototype.resetTransition=function(){this.markerDomRef&&(this.setTransition(""),setTimeout(this.addMovementTransition.bind(this)))};
g.prototype.addMovementTransition=function(){this.markerDomRef&&this.setTransition("transform "+(a.transition.intervalInMilliseconds||500)+"ms ease 0s")};g.prototype.setTransition=function(a){this.markerDomRef&&(this.markerDomRef.style.transition=a,this.bubble&&this.bubble.instant&&(this.bubble.instant.getElement().style.transition=a))};return g});m.when("A","rex-maptracker-constants","rex-maptracker-environments","here-maps-ready","pt2-page-utils").register("rex-maptracker",function(d,c,m,e,a){function g(a){this.options=
a||{};this.mapItems={};this.env=m.getEnvConfig();this.state=g.states.STARTUP;this.initialZoomTriggered=this.interactedWith=this.destroyed=!1}function p(a){f.ue&&f.ue.count&&f.ue.count(a,(f.ue.count(a)||0)+1)}var b=d.state("map-tracking-card-page-state"),l=[];g.states={STARTUP:"STARTUP",RENDERED:"RENDERED",OUT_FOR_DELIVERY:"OUT_FOR_DELIVERY",PICKED_UP:"PICKED_UP",YOU_ARE_NEXT:"YOU_ARE_NEXT",DELIVERED:"DELIVERED",ERROR:"ERROR",FATAL:"FATAL",ADDRESS_NOT_FOUND:"ADDRESS_NOT_FOUND",SKIPPED_STOP:"SKIPPED_STOP",
DELIVERY_FAILED:"DELIVERY_FAILED",DELIVERY_ATTEMPTED:"DELIVERY_ATTEMPTED",PARTIALLY_DELIVERED:"PARTIALLY_DELIVERED",REJECTED:"REJECTED",NOT_DELIVERED:"NOT_DELIVERED"};g.prototype.init=function(k){if(1!==k.nodeType)throw Error("containerElement must be a dom element");this.mapElement=k;var h={apikey:b&&b.hereMapsAPIKey?b.hereMapsAPIKey:null};try{this.platform=new H.service.Platform(h)}catch(u){throw Error("Unable to initialize HERE Maps Platform, error is: "+u);}h=this.platform.getRasterTileService();
h=new H.service.rasterTile.Provider(h);h=new H.map.layer.TileLayer(h);this.map=new H.Map(this.mapElement,h,{engineType:H.map.render.RenderEngine.EngineType.P2D,pixelRatio:1});this.map.getBaseLayer().setMin(c.minZoom).setMax(c.maxZoom);var d=this.wasInteractedWith.bind(this);this.map.addEventListener("dragend",d);this.map.addEventListener("dbltap",d);this.map.addEventListener("tap",d);this.ui=H.ui.UI.createDefault(this.map,h);this.ui.removeControl("mapsettings");this.ui.removeControl("scalebar");this.ui.removeControl("zoom");
this.ui.addControl("zoom",new H.ui.ZoomControl({fractionalZoom:!1,alignment:H.ui.LayoutAlignment.RIGHT_MIDDLE}));this.ui.getControl("zoom").getElement().style.right="-2em";(new H.mapevents.Behavior(new H.mapevents.MapEvents(this.map))).disable(H.mapevents.Behavior.Feature.FRACTIONAL_ZOOM);this.env.imperial&&this.ui.setUnitSystem(H.ui.UnitSystem.IMPERIAL);this.updateState(g.states.RENDERED);p("order-details-map-rendered");this.setHereMapsImprintPositioning(k);h=this.handleResize.bind(this);ResizeObserver&&
(new ResizeObserver(a.debounce(h,100))).observe(k);l.push(this)};g.prototype.addItem=function(a,b){b.init(this);this.mapItems[a]=b};g.prototype.destroy=function(){this.mapElement.innerHTML="";this.destroyed=!0;var a=l.indexOf(this);-1<a&&l.splice(a,1)};g.prototype.getPadding=function(){try{var a=this.map.getViewPort().padding}catch(h){}return a};g.prototype.setPadding=function(a,b,c,d){try{this.map.getViewPort().setPadding(a,b,c,d)}catch(x){}};g.prototype.setHereMapsImprintPositioning=function(a){try{var b=
a.querySelector(".H_imprint"),c=a.querySelector(".H_logo"),k=a.querySelector(".H_copyright");b.classList.add("od-map-imprint");c.classList.add("od-map-imprint-logo");k.classList.add("od-map-imprint-text");var d=k.childNodes[0];k.insertBefore(k.childNodes[1],d);var g=document.createElement("span");g.innerText="|";k.insertBefore(g,d)}catch(r){}};g.prototype.setMapBounds=function(a){var b=new H.map.Group;this.map.addObject(b);var c=this.mapItems,k=null,d=0,g=null,e=0;Object.keys(c).forEach(function(n){var h=
a.querySelector("."+n);n=c[n].marker;try{var f=n.getGeometry().lat;if(!k||0<f-k)d=h.getBoundingClientRect().height,k=f;if(!g||0>f-g)e=h.getBoundingClientRect().height,g=f;b.addObject(n)}catch(y){}});if(1<Object.keys(c).length&&!this.initialZoomTriggered){var f=this.getPadding();f&&this.setPadding(f.top+d+55,f.right,f.bottom+e+20,f.left)}this.updateMarkerBounds(b.getBoundingBox());this.initialZoomTriggered=!0};g.prototype.updateMarkerBounds=function(a){try{this.map.getViewModel().setLookAtData({bounds:a})}catch(h){}};
g.prototype.updateState=function(a){this.state=a};g.prototype.wasInteractedWith=function(){this.interactedWith=!0;p("order-details-map-interaction-"+this.options.mapType)};g.prototype.handleResize=function(){this.destroyed||this.state===g.states.STARTUP||this.map.getViewPort().resize()};f.addEventListener("resize",a.debounce(function(){l.forEach(function(a){a.handleResize()})},100));return g});m.when("ready").register("rex-maptracker-data-source-ajax-url",function(){return{getAjaxUrl:function(d){return f.location.origin+
"/progress-tracker/package/actions/package-location/get-state"}}});m.when("A","rex-maptracker-item","rex-maptracker-constants","pin-smoothing-config","rex-kalman-filter","rex-route-filter","rex-route-matching","csm-metrics-utils","ready").register("rex-maptracker-location-manager",function(d,c,f,e,a,g,m,b){function l(b){var c=e.smoothing.measurementCovariance,n=e.smoothing.processCovariance;this.mapTracker=b.mapTracker;this.onLocationChange=b.onLocationChange;this.realTimeMapType=b.realTimeMapType;
this.locations=[];this.lastDataReceivedAt=null;this.successfulAddLocationsCount=0;this.mapUpdateTimer=null;this.serverEpochDifference=0;this.state=l.states.READY;this.currentPlaybackSpeed=l.playbackSpeeds.DEFAULT;this.currentLocation=null;this.latitudeFilter=new a(c,n);this.longitudeFilter=new a(c,n);this.realTimeMapType=b.realTimeMapType}function k(a,b){var c=b.reduce(function(a,b){return Math.max(a,b.timestamp)},0);return a.filter(function(a){return a.timestamp>c})}function h(a){return a.filter(function(b,
c){var n=a[c-1];return n?!(v(n,b)>e.outlier.velocityThresholdInMetersPerSecond):(n=a[c+1],c=a[c+2],b=n?v(b,n)>e.outlier.velocityThresholdInMetersPerSecond:!1,n=n&&c?v(n,c)>e.outlier.velocityThresholdInMetersPerSecond:!1,!b||n)})}function z(a){a=JSON.parse(JSON.stringify(a));for(var b=0;b<a.length;b++){var c=a[b];if(!(c.accuracy<e.outlier.accuracyThreshold))if(0<b){var n=a[b-1];c.latitude=n.latitude;c.longitude=n.longitude;c.accuracy=n.accuracy}else a.splice(b,1),b--}return a}function u(a){var b=JSON.parse(JSON.stringify(a));
b.forEach(function(a,c){e.jitter.rules.forEach(function(n){if(!(c+n.subsequentPoints>b.length)){var k=b.slice(c+1,c+1+n.subsequentPoints);k.every(function(b){return r(a,b)<=n.maxDisplacementInMeters})&&k.forEach(function(b){b.isJitterFiltered||(b.latitude=a.latitude,b.longitude=a.longitude,b.isJitterFiltered=!0,b.isReal=!1)})}})});return b}function x(a){var b=[];a.forEach(function(a,c,n){if(c=n[c-1]){n=a.interpolatedTo;var k=c.isReal&&a.isReal&&!n&&r(c,a)<e.interpolation.maxDistanceToProcessInMeters;
n=Math.floor((a.timestamp-c.timestamp)/e.interpolation.intervalTargetInMilliseconds);if(k&&0<n){k=(a.latitude-c.latitude)/(n+1);for(var d=(a.longitude-c.longitude)/(n+1),g=(a.accuracy-c.accuracy)/(n+1),h=(a.timestamp-c.timestamp)/(n+1),f=0;f<n;f++)b.push(p(c.latitude+k*(f+1),c.longitude+d*(f+1),c.accuracy+g*(f+1),c.timestamp+h*(f+1),!1,!1,!0,!1,!1))}a=p(a.latitude,a.longitude,a.accuracy,a.timestamp,a.isReal,a.isSmoothed,!0,!1,!1);b.push(a)}});return b}function v(a,b){var c=(b.timestamp-a.timestamp)/
1E3;return r(a,b)/c}function r(a,b){var c=Math.PI/180*(b.latitude-a.latitude),n=Math.PI/180*(b.longitude-a.longitude);a=Math.sin(c/2)*Math.sin(c/2)+Math.cos(Math.PI/180*a.latitude)*Math.cos(Math.PI/180*b.latitude)*Math.sin(n/2)*Math.sin(n/2);return Math.abs(12742E3*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))}function p(a,b,c,k,d,g,f,h,e){return{latitude:a,longitude:b,accuracy:c,timestamp:k,isReal:d,isSmoothed:g,interpolatedTo:f,isJitterFiltered:h,isRouteFiltered:e}}l.states={READY:"READY",EXECUTING:"EXECUTING",
STOPPED:"STOPPED"};l.playbackSpeeds={DEFAULT:"DEFAULT",FAST:"FAST"};l.prototype.isReady=function(){return this.state===l.states.READY};l.prototype.addLocations=function(a){a=a.map(this.getLocationRecordFromServerModel.bind(this));a=this.getWithoutStaleLocations(a);a.sort(function(a,b){return a.timestamp-b.timestamp});a=k(a,this.locations);if(0===a.length)return Promise.resolve(!1);a=h(a);a=z(a);a=u(a);return m.isRouteMatchingEnabled(this.realTimeMapType)?g.filterRoute(a).then(function(a){return this.handleProcessedLocations(a)}.bind(this)):
Promise.resolve(this.handleProcessedLocations(a))};l.prototype.handleProcessedLocations=function(a){if(!a.length)return!1;if(this.realTimeMapType!==f.REAL_TIME_MAP_TYPE.DRONE||1!==a.length)a=x(a);"KALMAN_FILTER"===e.smoothing.smoothingType&&(a=this.getSmoothLocations(a));this.locations=this.getWithoutStaleLocations(this.locations.concat(a));this.successfulAddLocationsCount++;return!0};l.prototype.start=function(a){this.isReady()&&(this.state=l.states.EXECUTING,this.serverEpochDifference=a-Date.now(),
this.mapUpdateTimer=setInterval(this.updateMap.bind(this),e.mapUpdate.defaultIntervalInMilliseconds))};l.prototype.stop=function(){clearInterval(this.mapUpdateTimer);this.state=l.states.STOPPED};l.prototype.updateMap=function(){try{var a=this.getNextLocation();if(a){if(this.isLocationValid(a)){var c=!!this.currentLocation&&r(this.currentLocation,a)<=e.transition.maxDisplacementInMeters;this.updatePinLocation(a,c)}else if(this.isLocationTooOld(a)){var k=this.locations.find(function(a){return this.isLocationValid(a)}.bind(this));
k&&(c=!!this.currentLocation&&r(this.currentLocation,k)<=e.transition.maxDisplacementInMeters,this.updatePinLocation(k,c))}this.shouldFastForward()?this.updatePlaybackSpeed(l.playbackSpeeds.FAST):this.updatePlaybackSpeed(l.playbackSpeeds.DEFAULT)}}catch(y){b.incrementCount(f.metrics.PIN_SMOOTHING_MAP_UPDATE_ERROR),b.logError({error:y,feature:f.metrics.PIN_SMOOTHING_MAP_UPDATE_ERROR_LOG,message:"Pin smoothing map update error"})}};l.prototype.updatePinLocation=function(a,b){if(!this.currentLocation||
this.currentLocation.timestamp!==a.timestamp)if(this.mapTracker.mapItems.agent?this.mapTracker.mapItems.agent.updateLocation(a.latitude,a.longitude,b):this.mapTracker.addItem("agent",new c("agent",a.latitude,a.longitude,t,this.realTimeMapType)),this.currentLocation=a,"function"===typeof this.onLocationChange)this.onLocationChange()};l.prototype.updatePlaybackSpeed=function(a){if(a!==this.currentPlaybackSpeed){switch(a){case l.playbackSpeeds.DEFAULT:var b=e.mapUpdate.defaultIntervalInMilliseconds;
break;case l.playbackSpeeds.FAST:b=e.mapUpdate.fastIntervalInMilliseconds}b&&(this.mapUpdateTimer&&clearInterval(this.mapUpdateTimer),this.mapUpdateTimer=setInterval(this.updateMap.bind(this),b),this.playbackSpeed=a)}};l.prototype.getLocationRecordFromServerModel=function(a){return p(a.latitude,a.longitude,a.accuracy,a.epochTimestamp-this.serverEpochDifference,!0,!1,!1,!1,!1)};l.prototype.getCurrentDelay=function(){return this.currentLocation?Date.now()-this.currentLocation.timestamp:null};l.prototype.getNextLocation=
function(){var a=this.currentLocation;if(!a)return this.locations[0];var b=this.locations.findIndex(function(b){return b.timestamp===a.timestamp});return this.locations[b+1]};l.prototype.shouldFastForward=function(){return this.getCurrentDelay()>e.delay.defaultInMilliseconds};l.prototype.getSmoothLocations=function(a){if(!this.latitudeFilter||!this.longitudeFilter)return a;a=a.map(function(a){this.latitudeFilter.predict();this.longitudeFilter.predict();this.latitudeFilter.update(a.latitude,a.isSmoothed);
this.longitudeFilter.update(a.longitude,a.isSmoothed);return p(this.latitudeFilter.stateEstimate,this.longitudeFilter.stateEstimate,a.accuracy,a.timestamp,a.isReal,!0,a.interpolatedTo,a.isJitterFiltered,a.isRouteFiltered)}.bind(this));this.latitudeFilter.reset();this.longitudeFilter.reset();return a};l.prototype.getWithoutStaleLocations=function(a){return a.filter(function(a){return!this.isLocationTooOld(a)}.bind(this))};l.prototype.isLocationValid=function(a){return!this.isLocationTooOld(a)&&!this.isLocationTooRecent(a)};
l.prototype.isLocationTooOld=function(a){return a.timestamp<this.getMinEpochRenderThreshold()};l.prototype.isLocationTooRecent=function(a){return a.timestamp>Date.now()};l.prototype.getMinEpochRenderThreshold=function(){var a=this.successfulAddLocationsCount<e.delay.successfullAddLocationsCountToUseDefaultMax?e.delay.initialMaxInMilliseconds:e.delay.maxInMilliseconds;return Date.now()-a};return l});m.when("A","rex-maptracker","rex-maptracker-location-manager","rex-maptracker-constants","pin-smoothing-config",
"rex-maptracker-data-source-ajax-url","csm-metrics-utils","ready").register("rex-maptracker-data-source",function(d,c,m,e,a,g,p){function b(a,b,c){this.cookies=this.session_id="";this.trackingId=a.trackingId;this.timezone=a.timezone;this.realTimeMapType=a.realTimeMapType;this.mapElement=c;this.options=a;this.maptrackerLocationManager=null;this.lostSignalAttempt=this.numberOfMemoizations=0;this.firstTimeInvoke=!0;this.shouldStopPolling=!1;this.mapObject=b}function l(a,c,d){a=new b(a,c,d);a.startPolling();
return a}"undefined"===typeof f.mockLocationIndexes&&(f.mockLocationIndexes={});b.prototype.startPolling=function(){var a=this;a.maptrackerLocationManager=new m({mapTracker:a.mapObject,onLocationChange:function(){a.handleLocationChange()},realTimeMapType:a.realTimeMapType,mapElement:a.mapElement});if(!a.trackingId)throw a.handleResponse(c.states.FATAL,0,"MISSING_TRACKING_ID"),Error("Missing trackingId");if(a.options.sessionId)a.session_id=a.options.sessionId;else{if(!document.cookie)throw a.handleResponse(c.states.FATAL,
0,"MISSING_COOKIE"),Error("missing cookie");a.session_id=a.getSessionId(document.cookie)}if(!a.session_id)throw a.handleResponse(c.states.FATAL,0,"MISSING_SESSION_ID"),Error("missing session id");a.firstTimeInvoke=!0;a.requestData(a.trackingId,a.timezone,a.realTimeMapType)};b.prototype.handleResponse=function(a,b,c,d){"function"===typeof this.options.onDataReceived&&(a={status:a,stops:b,url:g.getAjaxUrl(this.realTimeMapType),mapObject:this.mapObject},c&&(a.message="Map tracking failed for the trackingId: "+
this.trackingId+" with reason: "+c),d&&(a.packageLocationState=d),this.options.onDataReceived(a))};b.prototype.requestData=function(a,b,f){var e=this;f=g.getAjaxUrl(f);a={trackingId:a,timezone:b,csrfToken:d.$('meta[name\x3d"pt-csrf-token"]').attr("content"),numberOfMemoizations:e.numberOfMemoizations};d.post(f,{params:a,withCredentials:!0,success:function(a){try{if(a&&a.success&&a.value){e.numberOfMemoizations++;var b=a.value,d=b.packageLocationTimeline;d&&e.maptrackerLocationManager.addLocations(d).then(function(a){a?
(e.firstTimeInvoke&&e.handleResponse(c.states.RENDERED,0,""),e.lostSignalAttempt=0,e.firstTimeInvoke=!1):e.handleLostSignal();e.maptrackerLocationManager.isReady()&&e.maptrackerLocationManager.start(b.currentEpoch);e.handleStatus(b)})}else{e.handleErrorResponse("EMPTY_RESPONSE");if("function"===typeof e.options.onDataReceivedError)e.options.onDataReceivedError("EMPTY_RESPONSE");e.handleStatus(b)}}catch(w){e.handleErrorResponse(w.stack),e.handleStatus(b)}},error:function(a,b,c){console.log("Error is :: "+
a.responseText+" "+b+" "+c);e.handleErrorResponse(a.responseText)}})};b.prototype.handleErrorResponse=function(b){p.incrementCount(e.metrics.PIN_SMOOTHING_AJAX_ERROR+"-"+this.realTimeMapType);this.handleLostSignal();var d=this.firstTimeInvoke?a.lostSignal.initialPageLoadCallThreshold:a.lostSignal.pollingCallThreshold;this.lostSignalAttempt<=d&&(this.handleResponse(c.states.ERROR,0,b),this.firstTimeInvoke?p.incrementCount(e.metrics.PIN_SMOOTHING_AJAX_IMMEDIATE_ERROR_RETRY_ATTEMPT+"-"+this.realTimeMapType+
this.lostSignalAttempt):p.incrementCount(e.metrics.PIN_SMOOTHING_AJAX_POLLING_ERROR_RETRY_ATTEMPT+"-"+this.realTimeMapType+this.lostSignalAttempt),this.recurAfterAWhile(this.firstTimeInvoke?a.polling.getImmediateIntervalInMilliseconds(this.lostSignalAttempt,d):a.polling.getErrorIntervalInMilliseconds(this.lostSignalAttempt,d)))};b.prototype.recurAfterAWhile=function(a){var b=this;b.shouldStopPolling||setTimeout(function(){b.requestData(b.trackingId,b.timezone,b.realTimeMapType)},a)};b.prototype.handleStatus=
function(b){var d=b.mapState||{},e=d.status,f=this.firstTimeInvoke?a.polling.getImmediateIntervalInMilliseconds(this.lostSignalAttempt,a.lostSignal.initialPageLoadCallThreshold):a.polling.getDefaultIntervalInMilliseconds(this.lostSignalAttempt,a.lostSignal.pollingCallThreshold);switch(e){case c.states.PICKED_UP:case c.states.YOU_ARE_NEXT:this.handleResponse(e,d.stops,"",b);this.recurAfterAWhile(f);break;case c.states.DELIVERED:this.maptrackerLocationManager.stop();this.removeAgentItem();this.handleResponse(e,
0,"",b);break;case c.states.SKIPPED_STOP:this.handleResponse(e,d.stops,"",b);this.recurAfterAWhile(f);break;case c.states.PARTIALLY_DELIVERED:case c.states.DELIVERY_ATTEMPTED:case c.states.NOT_DELIVERED:case c.states.REJECTED:this.removeAgentItem();this.handleResponse(e,0,"");break;default:this.handleErrorResponse("UNKNOWN_STATUS")}};b.prototype.handleLocationChange=function(){if("function"===typeof this.options.onLocationChange)this.options.onLocationChange()};b.prototype.handleLostSignal=function(){this.lostSignalAttempt++;
this.lostSignalAttempt>(this.firstTimeInvoke?a.lostSignal.initialPageLoadCallThreshold:a.lostSignal.pollingCallThreshold)&&"function"===typeof this.options.onDriverLostSignal&&(this.maptrackerLocationManager.stop(),this.shouldStopPolling=!0,this.options.onDriverLostSignal())};b.prototype.removeAgentItem=function(){if(this.mapObject.mapItems.agent&&this.mapObject.mapItems.agent.marker){var a=this.mapObject.mapItems.agent.marker.getParentGroup();a&&(a.removeObject(this.mapObject.mapItems.agent.marker),
this.mapObject.ui.removeBubble(this.mapObject.mapItems.agent.bubble.instant))}};b.prototype.getSessionId=function(a){var b="";this.cookies=a.replace(/ /g,"");for(a=0;a<this.cookies.split(";").length;a++){var c=this.cookies.split(";")[a].split("\x3d")[0],d=this.cookies.split(";")[a].split("\x3d")[1];"session-id"===c&&(b=d)}return b};return{createInstance:l,startPolling:function(a,b,c){return l(a,b,c)}}});m.when("ready").register("package-tracking-assets-real-time-map-type",function(){return{DEFAULT:"Default"}});
"use strict";m.when("A","ready").register("map-commons",function(d){return{METRICS_FEATURE_MAP_TRACKING_ERROR:"od-persistent-map-tracking-error",METRICS_FEATURE_MAP_TRACKING_ERROR_SECONDARY_STATUS:"od-persistent-map-tracking-error-secondary-status",METRICS_FEATURE_MAP_TRACKING_ERROR_MAP_TRACKER:"od-persistent-map-tracking-error-map-tracker",METRICS_FEATURE_MAP_TRACKING_ERROR_GENERIC:"od-persistent-map-tracking-error-generic",METRICS_FEATURE_MAP_TRACKING_WARN:"od-persistent-map-tracking-warn",METRICS_FEATURE_MAP_INITIALIZED:"od-persistent-map-initialized",
METRICS_FEATURE_MAP_ADDRESS_NOT_FOUND:"od-persistent-map-tracking-address-not-found",METRICS_FEATURE_MAP_ADDRESS_NOT_FOUND_PRE_RENDER:"od-persistent-map-tracking-address-not-found-pre-render",METRICS_FEATURE_MAP_ERROR_PRE_RENDER:"od-persistent-map-tracking-error-pre-render",METRICS_FEATURE_MAP_FATAL:"od-persistent-map-tracking-fatal",METRICS_FEATURE_MAP_FATAL_LOG:"od-persistent-map-tracking-fatal-log",METRICS_FEATURE_MAP_FATAL_PRE_RENDER:"od-persistent-map-tracking-fatal-pre-render",METRICS_FEATURE_MAP_DWELL_TIME:"od-persistent-map-tracking-map-dwell-time",
METRICS_FEATURE_MAP_ZOMBIE_TIME:"od-persistent-map-tracking-map-zombie-time",METRICS_FEATURE_MAP_SIGN_IN_AGAIN:"od-persistent-map-tracking-sign-in-again",METRICS_FEATURE_MAP_INVALID_TOKEN:"od-persistent-map-tracking-invalid-token",METRICS_FEATURE_MAP_INVALID_TOKEN_LOG:"od-persistent-map-tracking-invalid-token-log",METRICS_FEATURE_MAP_DELIVERY_FAILED_PREFIX:"od-persistent-map-tracking-",METRICS_FEATURE_MAP_MEMOIZATION_STATUS_PREFIX:"od-persistent-map-tracking-memoization-status-",METRICS_FEATURE_MAP_SKIPPED_STOP_AFTER_HEALTHY:"od-persistent-map-tracking-skipped-stop-after-healthy",
METRICS_FEATURE_MAP_SKIPPED_AFTER_X_STOPS_PATTERN:"od-persistent-map-tracking-skipped-after-[#]-stops",METRICS_FEATURE_MAP_SKIPPED_STOP_LANDING:"od-persistent-map-tracking-skipped-stop-landing",METRICS_FEATURE_MAP_SKIPPED_STOP_BECAME_HEALTHY:"od-persistent-map-tracking-skipped-stop-became_healthy",METRICS_FEATURE_MAP_ALREADY_DELIVERED:"od-persistent-map-tracking-already-delivered",METRICS_FEATURE_MAP_BECAME_DELIVERED:"od-persistent-map-tracking-became-delivered",METRICS_FEATURE_MAP_MEMOIZATION_SKIPPED:"od-persistent-map-tracking-memoization-skipped",
METRICS_FEATURE_MAP_RELOAD_AFTER_DELIVERY:"od-persistent-map-tracking-reload-after-delivery",TEXT_EMPHASIZED:"text-emphasized",METRICS_FEATURE_MAP_EVENT_LOG:"od-persistent-map-tracking-event-log",METRICS_FEATURE_MAP_FAILSAFED:"od-persistent-map-tracking-failsafed",METRICS_FEATURE_MAP_FAILSAFED_LOG:"od-persistent-map-tracking-failsafed-log",METRICS_FEATURE_MAP_FAILSAFED_PREMATURELY:"od-persistent-map-tracking-failsafed-prematurely",METRICS_FEATURE_MAP_FAILSAFED_LATENCY_SUFFIX:"od-persistent-map-tracking-failsafed-latency-",
METRICS_FEATURE_MAP_FAILSAFED_PREMATURELY_LOG:"od-persistent-map-tracking-failsafed-prematurely-log",METRICS_FEATURE_STATIC_MAP_COUNT:"od-persistent-map-type-static",METRICS_FEATURE_REAL_TIME_MAP_COUNT:"od-persistent-map-type-real-time",METRICS_FEATURE_REAL_TIME_MAP_RENDERED:"od-persistent-map-real-time-map-rendered",METRICS_FEATURE_NO_MAP_COUNT:"od-persistent-map-type-none",METRICS_FEATURE_PERSISTENT_MAP_STATIC_MAP_ERROR:"od-persistent-map-static-map-error",METRICS_FEATURE_PERSISTENT_MAP_GEOLOCATION_MISSING:"od-persistent-map-static-map-geolocation-missing",
METRICS_FEATURE_PERSISTENT_MAP_REALTIME_FALLBACK_TO_STATIC_MAP:"od-persistent-map-realtime-fallback-to-static",METRICS_FEATURE_PERSISTENT_MAP_REALTIME_FALLBACK_TO_STATIC_MAP_PREFIX:"od-persistent-map-realtime-fallback-to-static-",METRICS_FEATURE_PERSISTENT_MAP_REALTIME_FALLBACK_TO_STATIC_MAP_ERROR:"od-persistent-map-realtime-fallback-to-static-error",METRICS_FEATURE_PERSISTENT_MAP_REAL_TIME_MAP_ERROR:"od-persistent-map-real-time-map-error",METRICS_FEATURE_PERSISTENT_MAP_LONG_ADDRESS_MODAL_OPEN:"od-persistent-map-long-address-modal-open",
METRICS_FEATURE_PERSISTENT_MAP_FALLBACK_MESSAGE_LOST_SIGNAL:"od-persistent-map-fallback-message-lost-signal",METRICS_FEATURE_PERSISTENT_MAP_FALLBACK_MESSAGE_LOST_SIGNAL_SUPPRESSED:"od-persistent-map-fallback-message-lost-signal-suppressed",MapFallbackReason:{LOST_SIGNAL:"LOST_SIGNAL",NOT_AUTHENTICATED:"NOT_AUTHENTICATED",INVALID_TOKEN:"INVALID_TOKEN",FATAL:"FATAL",ADDRESS_NOT_FOUND:"ADDRESS_NOT_FOUND",REJECTED:"REJECTED",DELIVERED:"DELIVERED",NONE:"NONE"},fallbackToNoMap:function(c){c.closest(".od-map-outer-container").remove()}}});
"use strict";m.when("A","map-tracking-status","response-code","failsafe","map-commons","rex-maptracker-data-source","package-tracking-assets-real-time-map-type","csm-metrics-utils","map-tracking-confirmation","ready").register("real-time-map",function(d,c,m,e,a,g,p,b,l){function k(a){this.calloutMessage=null;this.realTimeMapType=p.DEFAULT;this.mapContainer=a.mapElement;this.mapTracker={};this.invalidTokenAlreadyReceived=this.signInAgainShown=!1;this.healthyNumberOfStops=null;this.rendered=!1;this.delivered=
null;this.sessionId=!1;this.dataSourceInstance=this.trackingId=null;this.fallbackMessageLostSignal=a.lostSignalAlertElement}var h={browser:!0},q=a.MapFallbackReason,u=d.state("map-tracking-card-page-state");k.prototype.loadRealTimeMap=function(c){var d=this;b.incrementCount(a.METRICS_FEATURE_REAL_TIME_MAP_COUNT,h);d.mapContainer=c.mapElement;var e=c.mapElement.querySelector(".map-attribute")||null;e=e?e.dataset:null;d.trackingId=e?e.trackingId:null;d.sessionId=u&&u.sessionId?u.sessionId:null;d.dataSourceInstance=
g.createInstance({trackingId:d.trackingId,sessionId:d.sessionId,timezone:"GMT",onDataReceived:function(a){d.processMapTrackerDataReceived(a)},onDataReceivedError:function(a){d.processMapTrackerDataReceivedError(a)},onDriverLostSignal:function(){d.handleDriverLostSignal()},onLocationChange:function(){d.handleAgentPositionChange()},realTimeMapType:d.realTimeMapType},c.mapTracker,c.mapElement)};k.prototype.processMapTrackerDataReceived=function(f){var g=f.packageLocationState&&f.packageLocationState.mapState;
this.mapTracker=f.mapObject;switch(f.status){case c.RENDERED:this.rendered=!0;e.hasFired()?(b.incrementCount(a.METRICS_FEATURE_MAP_FAILSAFED_PREMATURELY,h),b.incrementCount(a.METRICS_FEATURE_MAP_FAILSAFED_PREMATURELY+"-"+this.realTimeMapType,h),b.incrementCount(a.METRICS_FEATURE_MAP_FAILSAFED_LATENCY_SUFFIX+Math.floor(e.totalElapsedTime()/1E3),h),b.incrementCount(a.METRICS_FEATURE_MAP_FAILSAFED_LATENCY_SUFFIX+"-"+this.realTimeMapType+Math.floor(e.totalElapsedTime()/1E3),h),b.logError({feature:a.METRICS_FEATURE_MAP_FAILSAFED_PREMATURELY_LOG,
message:"Persistent Real Time Map failsafed prematurely for tracking Id: "+this.trackingId}),b.logError({feature:a.METRICS_FEATURE_MAP_FAILSAFED_PREMATURELY_LOG+"-"+this.realTimeMapType,message:"Persistent Real Time Map failsafed prematurely for tracking Id: "+this.trackingId})):e.reset();b.startWidgetTimer(a.METRICS_FEATURE_MAP_DWELL_TIME);b.startWidgetTimer(a.METRICS_FEATURE_MAP_DWELL_TIME+"-"+this.realTimeMapType);b.incrementCount(a.METRICS_FEATURE_REAL_TIME_MAP_RENDERED,h);b.incrementCount(a.METRICS_FEATURE_REAL_TIME_MAP_RENDERED+
"-"+this.realTimeMapType,h);break;case c.ERROR:this.rendered?(b.incrementCount(a.METRICS_FEATURE_MAP_TRACKING_ERROR),b.incrementCount(a.METRICS_FEATURE_MAP_TRACKING_ERROR+"-"+this.realTimeMapType)):(e.extend(),b.incrementCount(a.METRICS_FEATURE_MAP_ERROR_PRE_RENDER,h),b.incrementCount(a.METRICS_FEATURE_MAP_ERROR_PRE_RENDER+"-"+this.realTimeMapType,h));break;case c.FATAL:this.rendered?(this.updateCalloutMessage({calloutMessage:""}),b.incrementCount(a.METRICS_FEATURE_MAP_FATAL,h),b.incrementCount(a.METRICS_FEATURE_MAP_FATAL+
"-"+this.realTimeMapType,h)):(e.reset(),b.incrementCount(a.METRICS_FEATURE_MAP_FATAL_PRE_RENDER,h),b.incrementCount(a.METRICS_FEATURE_MAP_FATAL_PRE_RENDER+"-"+this.realTimeMapType,h));f.message&&("string"===typeof f.message?(b.incrementCount(a.METRICS_FEATURE_MAP_FATAL+"-"+f.message.toLowerCase().replace(/[\s_]+/g,"-"),h),b.incrementCount(a.METRICS_FEATURE_MAP_FATAL+"-"+this.realTimeMapType+"-"+f.message.toLowerCase().replace(/[\s_]+/g,"-"),h),b.logError({feature:a.METRICS_FEATURE_MAP_FATAL_LOG,message:"Persistent Real Time Map received fatal message ["+
f.message+"] with url ["+f.url+"] for tracking Id: "+this.trackingId}),b.logError({feature:a.METRICS_FEATURE_MAP_FATAL_LOG+"-"+this.realTimeMapType,message:"Persistent Real Time Map received fatal message ["+f.message+"] with url ["+f.url+"] for tracking Id: "+this.trackingId})):"object"===typeof f.message&&f.message.statusText&&(b.incrementCount(a.METRICS_FEATURE_MAP_FATAL+"-"+f.message.statusText.toLowerCase().replace(/[\s_]+/g,"-"),h),b.incrementCount(a.METRICS_FEATURE_MAP_FATAL+"-"+this.realTimeMapType+
"-"+f.message.statusText.toLowerCase().replace(/[\s_]+/g,"-"),h),b.logError({feature:a.METRICS_FEATURE_MAP_FATAL_LOG,message:"Persistent Real Time Map received fatal message ["+JSON.stringify(f.message)+"] with url ["+f.url+"] for tracking Id: "+this.trackingId}),b.logError({feature:a.METRICS_FEATURE_MAP_FATAL_LOG+"-"+this.realTimeMapType,message:"Persistent Real Time Map received fatal message ["+JSON.stringify(f.message)+"] with url ["+f.url+"] for tracking Id: "+this.trackingId})));break;case c.ADDRESS_NOT_FOUND:this.rendered?
(this.updateCalloutMessage({calloutMessage:""}),b.incrementCount(a.METRICS_FEATURE_MAP_ADDRESS_NOT_FOUND,h),b.incrementCount(a.METRICS_FEATURE_MAP_ADDRESS_NOT_FOUND+"-"+this.realTimeMapType,h)):(e.reset(),b.incrementCount(a.METRICS_FEATURE_MAP_ADDRESS_NOT_FOUND_PRE_RENDER,h),b.incrementCount(a.METRICS_FEATURE_MAP_ADDRESS_NOT_FOUND_PRE_RENDER+"-"+this.realTimeMapType,h));this.fallbackToStaticMap(q.ADDRESS_NOT_FOUND);break;default:d.$(this.mapContainer).is(":visible")?this.processGetPackageLocationStateSuccess(g):
(b.incrementCount(a.METRICS_FEATURE_MAP_MEMOIZATION_SKIPPED),b.incrementCount(a.METRICS_FEATURE_MAP_MEMOIZATION_SKIPPED+"-"+this.realTimeMapType))}};k.prototype.processGetPackageLocationStateSuccess=function(d){var e=this;b.incrementCount(a.METRICS_FEATURE_MAP_MEMOIZATION_STATUS_PREFIX+d.status.toLowerCase().replace(/_/g,"-"));b.incrementCount(a.METRICS_FEATURE_MAP_MEMOIZATION_STATUS_PREFIX+"-"+e.realTimeMapType+d.status.toLowerCase().replace(/_/g,"-"));switch(d.status){case c.PICKED_UP:case c.YOU_ARE_NEXT:null!==
e.healthyNumberOfStops&&0>e.healthyNumberOfStops&&(b.incrementCount(a.METRICS_FEATURE_MAP_SKIPPED_STOP_BECAME_HEALTHY),b.incrementCount(a.METRICS_FEATURE_MAP_SKIPPED_STOP_BECAME_HEALTHY+"-"+e.realTimeMapType));e.healthyNumberOfStops=d.stops;e.updateCalloutMessage(d);e.delivered=!1;break;case c.SKIPPED_STOP:null===e.healthyNumberOfStops?(b.incrementCount(a.METRICS_FEATURE_MAP_SKIPPED_STOP_LANDING),b.incrementCount(a.METRICS_FEATURE_MAP_SKIPPED_STOP_LANDING+"-"+e.realTimeMapType)):-1<e.healthyNumberOfStops&&
(b.incrementCount(a.METRICS_FEATURE_MAP_SKIPPED_AFTER_X_STOPS_PATTERN.replace("[#]",e.healthyNumberOfStops)),b.incrementCount(a.METRICS_FEATURE_MAP_SKIPPED_AFTER_X_STOPS_PATTERN.replace("[#]",e.healthyNumberOfStops)+"-"+e.realTimeMapType),b.incrementCount(a.METRICS_FEATURE_MAP_SKIPPED_STOP_AFTER_HEALTHY),b.incrementCount(a.METRICS_FEATURE_MAP_SKIPPED_STOP_AFTER_HEALTHY+"-"+e.realTimeMapType),e.healthyNumberOfStops=-1);e.updateCalloutMessage(d);e.delivered=!1;break;case c.PARTIALLY_DELIVERED:case c.DELIVERY_ATTEMPTED:case c.NOT_DELIVERED:case c.REJECTED:e.updateCalloutMessage(d);
b.incrementCount(a.METRICS_FEATURE_MAP_DELIVERY_FAILED_PREFIX+d.status.toLowerCase().replace(/_/g,"-"));b.incrementCount(a.METRICS_FEATURE_MAP_DELIVERY_FAILED_PREFIX+d.status.toLowerCase().replace(/_/g,"-")+"-"+e.realTimeMapType);e.fallbackToStaticMap(q.REJECTED);break;case c.DELIVERED:e.updateCalloutMessage(d),null===e.delivered?(b.incrementCount(a.METRICS_FEATURE_MAP_ALREADY_DELIVERED),b.incrementCount(a.METRICS_FEATURE_MAP_ALREADY_DELIVERED+"-"+e.realTimeMapType)):!1===e.delivered&&(b.incrementCount(a.METRICS_FEATURE_MAP_BECAME_DELIVERED),
b.incrementCount(a.METRICS_FEATURE_MAP_BECAME_DELIVERED+"-"+e.realTimeMapType)),e.delivered=!0,e.fallbackToStaticMap(q.DELIVERED),l(e.trackingId,function(){b.incrementCount(a.METRICS_FEATURE_MAP_RELOAD_AFTER_DELIVERY);b.incrementCount(a.METRICS_FEATURE_MAP_RELOAD_AFTER_DELIVERY+"-"+e.realTimeMapType);f.location.reload()},function(a){})}};k.prototype.processMapTrackerDataReceivedError=function(c){switch(c){case m.NOT_AUTHENTICATED:this.signInAgainShown||(this.signInAgainShown=!0,b.incrementCount(a.METRICS_FEATURE_MAP_SIGN_IN_AGAIN),
b.incrementCount(a.METRICS_FEATURE_MAP_SIGN_IN_AGAIN+"-"+this.realTimeMapType),this.fallbackToStaticMap(q.NOT_AUTHENTICATED));break;case m.INVALID_TOKEN:if(!this.invalidTokenAlreadyReceived){this.updateCalloutMessage({calloutMessage:""});this.invalidTokenAlreadyReceived=!0;const e=d.$('meta[name\x3d"pt-csrf-token"]').attr("content");c=(((new Date).getTime()-Page.loadedAt)/100).toFixed(1);b.incrementCount(a.METRICS_FEATURE_MAP_INVALID_TOKEN);b.incrementCount(a.METRICS_FEATURE_MAP_INVALID_TOKEN+"-"+
this.realTimeMapType);b.logError({feature:a.METRICS_FEATURE_MAP_INVALID_TOKEN_LOG,message:"Invalid csrf token ("+e.length+":"+c+")"});b.logError({feature:a.METRICS_FEATURE_MAP_INVALID_TOKEN_LOG+"-"+this.realTimeMapType,message:"Invalid csrf token ("+e.length+":"+c+")"});this.fallbackToStaticMap(q.INVALID_TOKEN)}}};k.prototype.setMapZoom=function(a){this.mapTracker&&!1===this.mapTracker.initialZoomTriggered&&this.mapTracker.setMapBounds(a)};k.prototype.updateCalloutMessage=function(a){this.isCalloutMessageValid(a.calloutMessage)&&
(this.calloutMessage=a.calloutMessage)};k.prototype.refreshCalloutMessage=function(){this.mapTracker.mapItems.agent&&this.isCalloutMessageValid(this.calloutMessage)&&this.mapTracker.mapItems.agent.updateBubble(this.calloutMessage)};k.prototype.isCalloutMessageValid=function(a){return!!a&&"string"===typeof a};k.prototype.updatePositioningBasedStyling=function(){var a=this.mapTracker.mapItems;if(a&&a.agent&&a.destination){var b=this.mapContainer,c=b.classList.contains("od-agent-below-destination");
(a=a.agent.latitude<a.destination.latitude)&&!c?b.classList.add("od-agent-below-destination"):!a&&c&&b.classList.remove("od-agent-below-destination")}};k.prototype.handleAgentPositionChange=function(){this.updatePositioningBasedStyling();this.setMapZoom(this.mapContainer);this.refreshCalloutMessage()};k.prototype.handleDriverLostSignal=function(){this.fallbackToStaticMapWithMessage(q.LOST_SIGNAL)};k.prototype.fallbackToStaticMapWithMessage=function(c){this.fallbackToStaticMap(c);switch(c){case q.LOST_SIGNAL:this.fallbackMessageLostSignal&&
(this.realTimeMapType===p.DRONE?b.incrementCount(a.METRICS_FEATURE_PERSISTENT_MAP_FALLBACK_MESSAGE_LOST_SIGNAL_SUPPRESSED,h):(b.incrementCount(a.METRICS_FEATURE_PERSISTENT_MAP_FALLBACK_MESSAGE_LOST_SIGNAL,h),b.incrementCount(a.METRICS_FEATURE_PERSISTENT_MAP_FALLBACK_MESSAGE_LOST_SIGNAL+"-"+this.realTimeMapType,h),this.showFallbackMessage()))}};k.prototype.fallbackToStaticMap=function(c){b.incrementCount(a.METRICS_FEATURE_PERSISTENT_MAP_REALTIME_FALLBACK_TO_STATIC_MAP,h);b.incrementCount(a.METRICS_FEATURE_PERSISTENT_MAP_REALTIME_FALLBACK_TO_STATIC_MAP+
"-"+this.realTimeMapType,h);b.incrementCount(a.METRICS_FEATURE_PERSISTENT_MAP_REALTIME_FALLBACK_TO_STATIC_MAP_PREFIX+c.toLowerCase().replace(/_/g,"-"),h);b.incrementCount(a.METRICS_FEATURE_PERSISTENT_MAP_REALTIME_FALLBACK_TO_STATIC_MAP_PREFIX+"-"+this.realTimeMapType+c.toLowerCase().replace(/_/g,"-"),h);try{if(this.mapTracker.mapItems.agent&&this.mapTracker.mapItems.agent.marker){var d=this.mapTracker.mapItems.agent.marker.getParentGroup();d&&(d.removeObject(this.mapTracker.mapItems.agent.marker),
this.mapTracker.ui.removeBubble(this.mapTracker.mapItems.agent.bubble.instant))}}catch(r){b.incrementCount(a.METRICS_FEATURE_PERSISTENT_MAP_REALTIME_FALLBACK_TO_STATIC_MAP_ERROR,h),b.incrementCount(a.METRICS_FEATURE_PERSISTENT_MAP_REALTIME_FALLBACK_TO_STATIC_MAP_ERROR+"-"+this.realTimeMapType,h),b.logError({error:r,feature:a.METRICS_FEATURE_PERSISTENT_MAP_REALTIME_FALLBACK_TO_STATIC_MAP_ERROR,message:"Persistent real time map fallback to static map failed for "+this.trackingId}),b.logError({error:r,
feature:a.METRICS_FEATURE_PERSISTENT_MAP_REALTIME_FALLBACK_TO_STATIC_MAP_ERROR+"-"+this.realTimeMapType,message:"Persistent real time map fallback to static map failed for "+this.trackingId}),a.fallbackToNoMap(this.mapContainer)}};k.prototype.showFallbackMessage=function(){this.fallbackMessageLostSignal.classList.remove("aok-hidden")};return{loadRealTimeMap:function(a){var b=new k(a);b.loadRealTimeMap(a);return b}}});"use strict";m.when("A","rex-maptracker","rex-maptracker-item","preload-images",
"a-modal","pt2-page-utils","package-tracking-assets-real-time-map-type","real-time-map","map-commons","csm-metrics-utils","ready").register("static-map",function(d,c,f,e,a,g,m,b,l,k){function h(a){const b=a.mapElement.getBoundingClientRect();a=document.querySelectorAll(".od-map-address-info-card");let c=null,d=Infinity;a.forEach((a)=>{var e=a.getBoundingClientRect(),f=e.left-b.left;e=e.top-b.top;f=Math.sqrt(f*f+e*e);f<d&&(d=f,c=a)});return c}function p(a){try{if(a.customerAddressInfo.latitude&&a.customerAddressInfo.longitude){a.mapTracker.init(a.mapElement);
var c=h(a);if(!c)throw Error("Address data not found for map instance "+a.id);var d=c.cloneNode(!0);a.mapTrackerItem=new f("destination",a.customerAddressInfo.latitude,a.customerAddressInfo.longitude,d,a.realTimeMapType,a.hideMapDestinationDetails);a.mapTracker.addItem("destination",a.mapTrackerItem);a.mapTracker.map.addObject(a.mapTrackerItem.marker);a.mapTracker.setMapBounds(a.mapElement);if(a.mapType===r.REAL_TIME_MAP){var e={mapTracker:a.mapTracker,mapItem:a.mapTrackerItem,mapElement:a.mapElement,
lostSignalAlertElement:a.lostSignalAlertElement};a.mapTracker.initialZoomTriggered=!1;b.loadRealTimeMap(e)}else a.mapType===r.STATIC_MAP&&k.incrementCount(l.METRICS_FEATURE_STATIC_MAP_COUNT,v)}else k.incrementCount(l.METRICS_FEATURE_PERSISTENT_MAP_GEOLOCATION_MISSING,v),l.fallbackToNoMap(a.mapElement)}catch(A){a.mapTracker.destroy(),a.errorRecoveryAttempt++,3>=a.errorRecoveryAttempt?q(a.firstTimeInvoke?50:1E4,a):(k.incrementCount(l.METRICS_FEATURE_PERSISTENT_MAP_STATIC_MAP_ERROR,v),l.fallbackToNoMap(a.mapElement))}}
function q(a,b){setTimeout(function(){p(b)},a)}function t(a,b){return isNaN(a)||isNaN(b)?!1:!w.some(function(c){return a===c.latitude&&b===c.longitude})}var v={browser:!0},r={STATIC_MAP:"StaticMap",REAL_TIME_MAP:"RealTimeMap",NO_MAP:"None"},w=[{latitude:0,longitude:0},{latitude:38,longitude:-97}];d=document.querySelectorAll(".od-map-outer-container");0!==d.length&&d.forEach(function(a){a={firstTimeInvoke:!0,mapType:null,customerAddressInfo:{},errorRecoveryAttempt:0,mapTrackerItem:{},mapTracker:{},
fullAddressModal:null,fullAddressBottomsheet:null,fullAddressSheetHeight:null,mapElement:a.querySelector(".od-map-card-container"),lostSignalAlertElement:a.querySelector(".od-map-lost-signal-alert"),mapTrackingData:null,realTimeMapType:m.DEFAULT,hideMapDestinationDetails:!1};if(a.mapElement){a.mapType=r.REAL_TIME_MAP;var b=document.querySelector(".od-map-shipping-address").dataset,d={};b&&b.addressGeocodeLatitude&&b.addressGeocodeLongitude&&t(+b.addressGeocodeLatitude,+b.addressGeocodeLongitude)&&
(d.latitude=b.addressGeocodeLatitude,d.longitude=b.addressGeocodeLongitude);a.customerAddressInfo=d;a.mapTracker=new c({mapType:r.STATIC_MAP});p(a)}else console.warn("Map element not found for instance")})});"use strict";m.register("csm-metrics-utils",function(){var d;try{var c=navigator.userAgent}catch(a){c=""}c&&(c=c.toLowerCase(),(c=c.match(/(chrome|firefox|safari|trident|ddge|opr|crios|fxios)/gi))&&0<c.length&&(-1<c.indexOf("safari")&&1<c.length?-1<c.indexOf("chrome")||-1<c.indexOf("crios")?d=
"chrome":-1<c.indexOf("fxios")&&(d="firefox"):d=c[0]));var m=[],e=function(a){f.ue&&f.uex&&uex("ld",a,{wb:1});a=m.indexOf(a);-1<a&&m.splice(a,1)};f.addEventListener("beforeunload",function(){for(;0<m.length;)e(m[0])});return{setScope:function(a){f.ue&&f.uet&&f.uet("tc",a);return a},setPreAjax:function(a){f.ue&&f.ues&&f.ues("t0",a,new Date)},setPostAjax:function(a){f.ue&&f.uet&&f.uet("be",a)},sendAjaxMetrics:function(a){f.ue&&f.uex&&f.uex("ld",a)},logError:function(a){if(f.ueLogError){var c=a.feature;
f.ueLogError(a.error||{message:a.message||c},{logLevel:"ERROR",attribution:c})}},logWarn:function(a){if(f.ueLogError){var c=a.feature;f.ueLogError(a.error||{message:a.message||c},{logLevel:"WARN",attribution:c})}},incrementCount:function(a,c){f.ue&&f.ue.count&&(f.ue.count(a,(f.ue.count(a)||0)+1),c&&c.browser&&d&&f.ue.count(a+"-"+d,(f.ue.count(a+"-"+d)||0)+1))},recordInterval:function(a,c,e){f.ue&&f.ue.count&&(f.ue.count(a,c),e&&e.browser&&d&&f.ue.count(a+"-"+d,c))},startWidgetTimer:function(a){f.ue&&
f.uet&&0>m.indexOf(a)&&(uet("bb",a,{wb:1}),m.push(a))},stopWidgetTimer:e}})});